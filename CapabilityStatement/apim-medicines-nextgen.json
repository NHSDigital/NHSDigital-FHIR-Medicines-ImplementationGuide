{
    "resourceType": "CapabilityStatement",
    "id": "apim-eps-nextgen",
    "extension":  [
        {
            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition",
            "extension":  [
                {
                    "url": "implementationGuide",
                    "extension":  [
                        {
                            "url": "name",
                            "valueString": "uk.nhsdigital.r4.test"
                        }
                    ]
                },
                {
                    "url": "implementationGuide",
                    "extension":  [
                        {
                            "url": "name",
                            "valueString": "uk.nhsdigital.medicines.r4.test"
                        }
                    ]
                },
                {
                    "url": "implementationGuide",
                    "extension":  [
                        {
                            "url": "name",
                            "valueString": "UKCore.Release1.test"
                        },
                        {
                            "url": "version",
                            "valueString": "1.2.2-prerelease"
                        }
                    ]
                },
                {
                    "url": "openApi",
                    "extension":  [
                        {
                            "url": "documentation",
                            "valueUri": "https://digital.nhs.uk/developer/api-catalogue/electronic-prescription-service-fhir"
                        },
                        {
                            "url": "description",
                            "valueString": "Electronic Prescription Service - FHIR API"
                        }
                    ]
                }
            ]
        }
    ],
    "url": "https://fhir.nhs.uk/CapabilityStatement/apim-eps-nextgen",
    "version": "3.0.0",
    "name": "APIMEPSNextGen",
    "status": "active",
    "date": "2021-04-28T00:00:00+00:00",
    "publisher": "digital.nhs.uk",
    "description": "Conformance requirements for NHS Digital EPS NextGen APIs",
    "kind": "requirements",
    "implementationGuide":  [
        "https://simplifier.net/guide/nhsdigital-medicine",
        "https://simplifier.net/guide/nhsdigital"
    ],
    "fhirVersion": "4.0.1",
    "format":  [
        "application/fhir+json"
    ],
    "rest":  [
        {
            "mode": "server",
            "security": {
                "service":  [
                    {
                        "coding":  [
                            {
                                "system": "http://terminology.hl7.org/CodeSystem/restful-security-service",
                                "code": "OAuth",
                                "display": "OAuth2 Token"
                            }
                        ]
                    }
                ]
            },
            "resource":  [
                {
                    "type": "List",
                    "profile": "https://fhir.hl7.org.uk/StructureDefinition/UKCore-List"
                },
                {
                    "type": "Claim",
                    "profile": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-Claim",
                    "interaction":  [
                        {
                            "extension":  [
                                {
                                    "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                                    "extension":  [
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": true
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Claim/258E153F-567B-4D60-B045-BA315A6B8DB0"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "code": "create",
                            "documentation": "Use this endpoint to submit a claim for reimbursement for a dispensed prescription."
                        },
                        {
                            "extension":  [
                                {
                                    "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                                    "extension":  [
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": true
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Claim/258E153F-567B-4D60-B045-BA315A6B8DB0"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "code": "update",
                            "documentation": "Use this endpoint to submit a claim for reimbursement for a dispensed prescription."
                        }
                    ]
                },
                {
                    "type": "CommunicationRequest",
                    "profile": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-CommunicationRequest"
                },
                {
                    "type": "MedicationRequest",
                    "profile": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationRequest"
                },
                {
                    "type": "MedicationDispense",
                    "profile": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-MedicationDispense"
                },
                {
                    "type": "Medication",
                    "profile": "https://fhir.hl7.org.uk/StructureDefinition/UKCore-Medication"
                },
                {
                    "type": "Task",
                    "profile": "https://fhir.nhs.uk/StructureDefinition/NHSDigital-DM-Task",
                    "extension":  [
                        {
                            "url": "http://hl7.org/fhir/StructureDefinition/capabilitystatement-search-parameter-combination",
                            "extension":  [
                                {
                                    "url": "required",
                                    "valueString": "identifier"
                                }
                            ]
                        },
                        {
                            "url": "http://hl7.org/fhir/StructureDefinition/capabilitystatement-search-parameter-combination",
                            "extension":  [
                                {
                                    "url": "required",
                                    "valueString": "foucs:identifier"
                                }
                            ]
                        },
                        {
                            "url": "http://hl7.org/fhir/StructureDefinition/capabilitystatement-search-parameter-combination",
                            "extension":  [
                                {
                                    "url": "required",
                                    "valueString": "patient:identifier"
                                }
                            ]
                        }
                    ],
                    "interaction":  [
                        {
                            "extension":  [
                                {
                                    "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                                    "extension":  [
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": true
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Task/ee1b55f8-113c-4725-99a3-25fbad366dd6"
                                                    }
                                                },
                                                {
                                                    "url": "summary",
                                                    "valueMarkdown": "Return a prescription to spine"
                                                },
                                                {
                                                    "url": "description",
                                                    "valueMarkdown": "No dispense notifications may exist on spine for this action. Use withdraw dispense notification to remove them from spine."
                                                }
                                            ]
                                        },
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": true
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Task/6a2624a2-321b-470e-91a6-8ae7a065e2f0"
                                                    }
                                                },
                                                {
                                                    "url": "summary",
                                                    "valueMarkdown": "Withdraw a dispense notification"
                                                },
                                                {
                                                    "url": "description",
                                                    "valueMarkdown": "Use this endpoint to withdraw the **last** dispense-notification message, for example in the case that a prescription was marked as dispensed erroneously."
                                                }
                                            ]
                                        },
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": true
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Task/1291fcca-902b-48f3-9d07-1be9ea30d7a0"
                                                    }
                                                },
                                                {
                                                    "url": "summary",
                                                    "valueMarkdown": "Cancel a Prescription (proposed)"
                                                },
                                                {
                                                    "url": "description",
                                                    "valueMarkdown": "This is a proposed replacement for the prescription-order-update message."
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "code": "create",
                            "documentation": "Used for returns prescriptions to spine. Should be a PUT"
                        },
                        {
                            "extension":  [
                                {
                                    "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                                    "extension":  [
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": false
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Task/bd1ca5c4-ff49-4f2a-9db4-f5dda011208"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "code": "search-type",
                            "documentation": "The EPS Tracker"
                        }
                    ],
                    "operation":  [
                        {
                            "extension":  [
                                {
                                    "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                                    "extension":  [
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": true
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Parameters/45a3cbe4-7688-418b-91d3-8f6d5ca94905"
                                                    }
                                                }
                                            ]
                                        },
                                        {
                                            "url": "example",
                                            "extension": [
                                                {
                                                    "url": "request",
                                                    "valueBoolean": false
                                                },
                                                {
                                                    "url": "value",
                                                    "valueReference": {
                                                        "reference": "Bundle/E9DDBBC4-DA9A-C223-A2E3-909534332C69"
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "name": "release",
                            "definition": "https://fhir.nhs.uk/OperationDefinition/Task-release-message"
                        }
                    ],
                    "searchParam":  [
                        {
                            "name": "identifier",
                            "type": "token",
                            "documentation": "The short form identifier of the prescription you are searching for."
                        },
                        {
                            "name": "focus:identifier",
                            "type": "token",
                            "documentation": "The short form identifier of the prescription you are searching for."
                        },
                        {
                            "name": "patient:identifier",
                            "type": "token",
                            "documentation": "The NHS Number of the patient whose prescriptions you are searching for."
                        },
                        {
                            "name": "authored-on",
                            "type": "date",
                            "documentation": "Date the prescription was authored"
                        },
                        {
                            "name": "business-status",
                            "type": "token",
                            "documentation": "The state that a prescription is in."
                        }
                    ]
                }
            ],
            "operation":  [
                {
                    "extension":  [
                        {
                            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                            "extension":  [
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": false
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "OperationOutcome/c9643613-0b72-4453-bfd2-71bfd2330c73"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    "name": "process-message",
                    "definition": "https://fhir.nhs.uk/OperationDefinition/MessageHeader-process-message"
                },
                {
                    "name": "prepare",
                    "definition": "https://fhir.nhs.uk/OperationDefinition/MessageHeader-prepare-message",
                    "extension":  [
                        {
                            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                            "extension":  [
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": true
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "Bundle/homecare-prepare"
                                            }
                                        }
                                    ]
                                },
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": false
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "Parameters/320b2e2a-0fa0-4ffa-ad3d-f223c27e849d"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ],
    "messaging":  [
        {
            "supportedMessage":  [
                {
                    "mode": "receiver",
                    "definition": "https://fhir.nhs.uk/MessageDefinition/prescription-order",
                    "extension":  [
                        {
                            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                            "extension":  [
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": true
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "Bundle/hce-DC2C66-A1B2C3-23407B"
                                            }
                                        }
                                    ]
                                }
                               
                            ]
                        }
                    ]
                },
                {
                    "mode": "receiver",
                    "definition": "https://fhir.nhs.uk/MessageDefinition/prescription-order-update",
                    "extension":  [
                        {
                            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                            "extension":  [
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": true
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "Bundle/homecare-update"
                                            }
                                        }
                                    ]
                                }
                               
                            ]
                        }
                    ]
                },
                {
                    "mode": "receiver",
                    "definition": "https://fhir.nhs.uk/MessageDefinition/dispense-notification",
                    "extension":  [
                        {
                            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                            "extension":  [
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": true
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "Bundle/334a3195-1f6c-497a-8efe-d272ca9c4e38"
                                            }
                                        }
                                    ]
                                }
                               
                            ]
                        }
                    ]
                },
                {
                    "mode": "receiver",
                    "definition": "https://fhir.nhs.uk/MessageDefinition/dispense-notification-update",
                    "extension":  [
                        {
                            "url": "https://fhir.nhs.uk/StructureDefinition/Extension-NHSDigital-APIDefinition-OAS",
                            "extension":  [
                                {
                                    "url": "example",
                                    "extension": [
                                        {
                                            "url": "request",
                                            "valueBoolean": true
                                        },
                                        {
                                            "url": "value",
                                            "valueReference": {
                                                "reference": "Bundle/1e9d39ef-e999-4ab5-8fa1-bf8a0ff0ea98"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}
